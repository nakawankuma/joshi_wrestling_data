<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>女子プロレス選手一覧表</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .content {
            padding: 30px;
        }
        
        .debug-controls {
            margin: 30px 0 10px 0;
            text-align: center;
        }
        
        .debug-toggle {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 10px;
            font-weight: normal;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            opacity: 0.7;
        }
        
        .debug-toggle:hover {
            background: linear-gradient(135deg, #495057, #343a40);
            transform: translateY(-1px);
            opacity: 1;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .stats-summary {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 30px 0;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .controls {
            display: none;
            gap: 15px;
            margin: 20px 0;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .filter-info {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .table-container {
            margin: 30px 0;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
        }
        
        .table-wrapper {
            overflow-x: auto;
            max-height: 800px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            min-width: 1400px;
        }
        
        /* 絞り込み時のテーブル幅調整 */
        .table-container.filtered table {
            min-width: auto;
            width: auto;
        }
        
        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 8px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 10;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        th:hover {
            background: linear-gradient(135deg, #5a67d8, #667eea);
        }
        
        th:first-child {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            position: sticky;
            left: 0;
            z-index: 11;
            min-width: 80px;
            width: auto;
        }
        
        th:first-child:hover {
            background: linear-gradient(135deg, #e55656, #d63031);
        }
        
        .sortable::after {
            content: ' ↕';
            font-size: 12px;
            opacity: 0.7;
        }
        
        
        .sortable.desc::after {
            content: ' ↓';
            opacity: 1;
        }
        
        td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            vertical-align: top;
            line-height: 1.4;
            max-width: 150px;
            word-wrap: break-word;
        }
        
        td:first-child {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            font-weight: bold;
            text-align: center;
            position: sticky;
            left: 0;
            z-index: 9;
            min-width: 80px;
            width: auto;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        td:first-child:hover {
            background: linear-gradient(135deg, #e55656, #d63031);
        }
        
        tr:nth-child(even) td:not(:first-child) {
            background: #f8f9fa;
        }
        
        tr:hover td:not(:first-child) {
            background: #e3f2fd;
        }
        
        
        
        
        .promotion-header {
            font-size: 11px;
            writing-mode: horizontal-tb;
            text-orientation: mixed;
            min-width: 120px;
            max-width: 120px;
            transition: min-width 0.3s ease, max-width 0.3s ease;
        }
        
        /* 絞り込み時の動的列幅調整 */
        .table-container.filtered .promotion-header:not(.hidden-column) {
            min-width: 120px;
            max-width: 250px;
            width: auto;
        }
        
        .table-container.filtered td:not(:first-child):not(.hidden-column) {
            min-width: 120px;
            max-width: 250px;
            width: auto;
        }
        
        /* 絞り込み時のデビュー年列の幅調整 */
        .table-container.filtered th:first-child,
        .table-container.filtered td:first-child {
            width: 60px;
            min-width: 60px;
            max-width: 60px;
        }

        /* 携帯での絞り込み時の特別調整 */
        @media (max-width: 768px) {
            .table-container.filtered .promotion-header:not(.hidden-column) {
                min-width: 80px;
                max-width: 120px;
                font-size: 9px;
            }
            
            .table-container.filtered td:not(:first-child):not(.hidden-column) {
                min-width: 80px;
                max-width: 120px;
                font-size: 10px;
            }
            
            .table-container.filtered th:first-child,
            .table-container.filtered td:first-child {
                width: 40px;
                min-width: 40px;
                max-width: 40px;
                font-size: 9px;
            }
        }
        
        .year-detail-view {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .year-title {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .promotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .promotion-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-top: 3px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .promotion-name-card {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .wrestler-names-card {
            color: #2d3436;
            line-height: 1.6;
        }
        
        /* 検索機能のスタイル */
        .search-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }
        
        .search-input:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }
        
        .clear-btn {
            background: linear-gradient(135deg, #a55eea, #8e44ad);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .clear-btn:hover {
            background: linear-gradient(135deg, #9c88ff, #7f39fb);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        /* 検索結果のハイライト */
        .highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        /* 非表示列のスタイル */
        .hidden-column {
            display: none !important;
        }

        /* レスポンシブデザイン対応 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
                border-radius: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .header p {
                font-size: 14px;
                margin: 0;
            }
            
            .content {
                padding: 15px;
            }
            
            .stats-summary {
                max-width: 200px;
                margin: 20px auto;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            .search-container {
                flex-direction: column;
                gap: 10px;
                max-width: 100%;
                margin: 15px 0;
            }
            
            .search-input {
                font-size: 16px;
                padding: 12px;
            }
            
            .clear-btn {
                width: 100%;
                padding: 12px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .back-btn {
                width: 100%;
                padding: 12px;
                font-size: 16px;
            }
            
            .filter-info {
                text-align: center;
                margin: 0;
            }
            
            /* テーブル関連の携帯対応 */
            .table-container {
                margin: 15px 0;
                border-radius: 10px;
            }
            
            .table-wrapper {
                max-height: 60vh;
            }
            
            table {
                font-size: 11px;
                min-width: auto;
            }
            
            th, td {
                padding: 8px 4px;
                font-size: 10px;
                /* タッチ操作向けに最小タップ領域を確保 */
                min-height: 44px;
            }
            
            /* 携帯では固定位置を無効化 */
            th {
                position: static !important;
                top: auto !important;
                left: auto !important;
                z-index: auto !important;
            }
            
            th:first-child, td:first-child {
                min-width: 50px;
                width: 50px;
                font-size: 9px;
                /* 年度セルのタッチ領域を広げる */
                cursor: pointer;
                user-select: none;
                -webkit-touch-callout: none;
                /* 携帯では固定位置を無効化 */
                position: static !important;
                left: auto !important;
                z-index: auto !important;
            }
            
            td:first-child {
                /* 年度セルの固定位置も無効化 */
                position: static !important;
                left: auto !important;
                z-index: auto !important;
            }
            
            .promotion-header {
                min-width: 60px;
                max-width: 80px;
                font-size: 9px;
                /* 携帯では縦書きに変更 */
                writing-mode: vertical-rl;
                text-orientation: mixed;
                /* タッチ操作の改善 */
                cursor: pointer;
                user-select: none;
                -webkit-touch-callout: none;
                /* タップ時のハイライト抑制 */
                -webkit-tap-highlight-color: transparent;
            }
            
            /* 年別詳細ビューの携帯対応 */
            .year-detail-view {
                padding: 15px;
                margin: 15px 0;
            }
            
            .year-title {
                font-size: 1.2rem;
                padding: 12px;
            }
            
            .promotion-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .promotion-card {
                padding: 12px;
            }
            
            .promotion-name-card {
                font-size: 14px;
                margin-bottom: 8px;
            }
            
            .wrestler-names-card {
                font-size: 13px;
                line-height: 1.4;
            }
            
            /* デバッグコントロールの調整 */
            .debug-controls {
                margin: 20px 0 5px 0;
            }
            
            .debug-toggle {
                font-size: 9px;
                padding: 4px 8px;
            }
        }

        /* タブレット対応 (769px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                margin: 15px;
            }
            
            .content {
                padding: 25px;
            }
            
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 10px 6px;
            }
            
            .promotion-header {
                min-width: 100px;
                max-width: 110px;
                font-size: 10px;
                /* タブレットでは横書きを維持 */
                writing-mode: horizontal-tb;
                text-orientation: mixed;
            }
        }
    </style>
</head>
<body>

    <div class="container" id="content">
        <div class="header">
            <h1>🤼‍♀️ 女子プロレス選手一覧表 🤼‍♀️</h1>
            <p>現役選手のデビュー年・団体別完全データ</p>
        </div>
        
        <div class="content">
            <div class="stats-summary">
                <div class="stat-card">
                    <div class="stat-number" id="totalWrestlers">計算中...</div>
                    <div class="stat-label" id="totalWrestlersLabel">総現役選手数</div>
                </div>
            </div>
            
            <!-- 選手名検索機能 -->
            <div class="search-container">
                <input type="text" id="wrestlerSearch" placeholder="選手名で検索..." class="search-input" aria-label="選手名検索" oninput="searchWrestlers()" onkeyup="searchWrestlers()">
                <button onclick="clearSearch()" class="clear-btn">クリア</button>
            </div>
            
            <div class="controls" id="controls">
                <!-- コントロールボタンがここに動的に追加されます -->
            </div>
            
            <div class="year-detail-view" id="yearDetailView">
                <!-- 年別詳細ビューがここに表示されます -->
            </div>
            
            <div class="table-container" id="tableContainer">
                <div class="table-wrapper">
                    <table id="wrestlersTable">
                        <thead>
                            <tr>
                                <th class="sortable desc" onclick="toggleSort()">デビュー年</th>
                                <th class="promotion-header" onclick="filterByPromotion('Stardom', 1)">Stardom</th>
                                <th class="promotion-header" onclick="filterByPromotion('AWG', 2)">AWG</th>
                                <th class="promotion-header" onclick="filterByPromotion('TJPW', 3)">TJPW</th>
                                <th class="promotion-header" onclick="filterByPromotion('マリゴ', 4)">マリゴ</th>
                                <th class="promotion-header" onclick="filterByPromotion('IR/ホットシュシュ', 5)">IR/ホットシュシュ</th>
                                <th class="promotion-header" onclick="filterByPromotion('JTO', 6)">JTO</th>
                                <th class="promotion-header" onclick="filterByPromotion('チョコプロ', 7)">チョコプロ</th>
                                <th class="promotion-header" onclick="filterByPromotion('Diana', 8)">Diana</th>
                                <th class="promotion-header" onclick="filterByPromotion('Pure-J', 9)">Pure-J</th>
                                <th class="promotion-header" onclick="filterByPromotion('マーベラス', 10)">マーベラス</th>
                                <th class="promotion-header" onclick="filterByPromotion('SENDAI', 11)">SENDAI</th>
                                <th class="promotion-header" onclick="filterByPromotion('Wave', 12)">Wave</th>
                                <th class="promotion-header" onclick="filterByPromotion('シード', 13)">シード</th>
                                <th class="promotion-header" onclick="filterByPromotion('LLPW-X', 14)">LLPW-X</th>
                                <th class="promotion-header" onclick="filterByPromotion('2.5', 15)">2.5</th>
                                <th class="promotion-header" onclick="filterByPromotion('ガンプロ', 16)">ガンプロ</th>
                                <th class="promotion-header" onclick="filterByPromotion('柳ヶ瀬', 17)">柳ヶ瀬</th>
                                <th class="promotion-header" onclick="filterByPromotion('エボリューション', 18)">エボリューション</th>
                                <th class="promotion-header" onclick="filterByPromotion('海外', 19)">海外</th>
                                <th class="promotion-header" onclick="filterByPromotion('その他', 20)">その他</th>
                                <th class="promotion-header" onclick="filterByPromotion('フリー', 21)">フリー</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- データがJavaScriptで追加されます -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- デバッグコントロール（一番下に小さく配置） -->
            <div class="debug-controls">
                <button class="debug-toggle" onclick="toggleDebug()">🔧 デバッグ情報 表示/非表示</button>
            </div>
            
            <!-- デバッグ情報表示エリア -->
            <div class="debug-info" id="debugInfo">
                <strong>デバッグログ:</strong><br>
                読み込み開始...<br>
            </div>
        </div>
    </div>

    <script>
        // デバッグ用ログ関数
        function debugLog(message) {
            const debugInfo = document.getElementById('debugInfo');
            const currentTime = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `${currentTime}: ${message}<br>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
            console.log(message);
        }

        // グローバル変数
        let sortOrder = 'desc';
        let currentFilter = null;
        let isFiltered = false;
        let debugVisible = false;
        let originalData = null; // 検索前のオリジナルデータ保存用
        let isSearching = false; // 検索中フラグ

        debugLog('スクリプト開始 - グローバル変数初期化完了');

        // デバッグ表示切り替え関数
        function toggleDebug() {
            debugVisible = !debugVisible;
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.style.display = debugVisible ? 'block' : 'none';
            debugLog(`デバッグ表示: ${debugVisible ? '表示' : '非表示'}`);
        }

        // データを直接定義（完全版）
        const wrestlerData = [
            [
                        1977,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "ジャガー横田",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1978,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1979,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1980,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "長与千種",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "ダンプ松本"
            ],
            [
                        1981,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1982,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1983,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1984,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1985,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "堀田祐美子(T-HEARTS)",
                        ""
            ],
            [
                        1986,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "神取忍",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "尾崎魔弓(OZ)",
                        "アジャコング"
            ],
            [
                        1987,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "下田美馬"
            ],
            [
                        1988,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "井上京子",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "井上貴子",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1989,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "伊藤薫(伊藤道場)",
                        "渡辺智子"
            ],
            [
                        1990,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1991,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1992,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1993,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1994,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        1995,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "さくらえみ",
                        "",
                        "",
                        "",
                        "",
                        "宮崎有妃(2026.1.1引退予定)",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "加藤園子(OZ)(2025.11.23引退予定)\nミス・モンゴル(世界)",
                        "永島千佳世\n倉垣翼"
            ],
            [
                        1996,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "シン・広田さくら"
            ],
            [
                        1997,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "KAZUKI",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "藪下めぐみ"
            ],
            [
                        1998,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "AKINO(OZ)",
                        "救世忍者乱丸"
            ],
            [
                        1999,
                        "フキゲンです",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "米山香織(ゴキゲン)",
                        ""
            ],
            [
                        2000,
                        "",
                        "MARU",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "Leon",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "山縣優\n唯我"
            ],
            [
                        2001,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "佐藤綾子",
                        "",
                        "",
                        "",
                        "桜花由美",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        2002,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "ハイビスカスみぃ(琉球)",
                        ""
            ],
            [
                        2003,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        ""
            ],
            [
                        2004,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "バンビ(世界)",
                        "チェリー\n水波綾"
            ],
            [
                        2005,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "春日萌花",
                        "",
                        "",
                        "",
                        "ラム会長(666)",
                        "群馬"
            ],
            [
                        2006,
                        "",
                        "",
                        "",
                        "",
                        "みなみ飛香(IR)(休)",
                        "",
                        "",
                        "",
                        "中森華子",
                        "",
                        "DASHチサコ",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "里歩(AEW)",
                        "",
                        "野崎渚\n真琴\n松本浩代\n雫有希"
            ],
            [
                        2007,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "紫雷イオ(WWE)",
                        "",
                        "紫雷美央\nキラアン\nガキにゃん仮面"
            ],
            [
                        2008,
                        "朱里(休)",
                        "",
                        "",
                        "",
                        "藤本つかさ(IR)(休)\n星ハム子(IR)",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "志田光(AEW)",
                        "",
                        "松本都"
            ],
            [
                        2009,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "石橋葵(世界)",
                        ""
            ],
            [
                        2010,
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "帯広さやか",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "世志琥(休)",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "柊くるみ(PR)\n夏実もち(PR)\nLINDA(信州)",
                        ""
            ],
            [
                        2011,
                        "鹿島沙希",
                        "",
                        "",
                        "岩谷麻優",
                        "勝愛実(IR)",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "ハイジ・カトリーナ",
                        "",
                        "",
                        "",
                        "",
                        "HARUKAZE",
                        "",
                        "",
                        "KAIRI(WWE)",
                        "",
                        "Sareee"
            ],
            [
                        2012,
                        "",
                        "惡斗",
                        "瑞希",
                        "翔月なつみ",
                        "",
                        "",
                        "",
                        "",
                        "ライディーン鋼",
                        "彩羽匠",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "SAKI(COLORS)\n世羅りさ(PR)(2026.1.12引退予定)",
                        ""
            ],
            [
                        2013,
                        "コグマ\n葉月\nAZM",
                        "",
                        "山下実優\n中島翔子",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "まなせゆうな",
                        "",
                        "",
                        "坂崎ユカ(AEW)",
                        "YAKO(アルマリブレ)",
                        "山下りな\n日向小陽(休)\n夏 すみれ\n藤田あかね\n小林香萌\n上福ゆき\n弓李"
            ],
            [
                        2014,
                        "渡辺桃",
                        "",
                        "辰巳リカ",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "雪妃真矢"
            ],
            [
                        2015,
                        "スターライト・キッド\nなつぽい\n安納サオリ\n小波",
                        "",
                        "ハイパーミサヲ",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "岩田美香\n橋本千紘",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "ASUKA(WWE)",
                        "",
                        "VENY\n尾崎妹加\n本間多恵(2025.10.13引退予定)\nジャングル叫女"
            ],
            [
                        2016,
                        "刀羅ナツコ\n琉悪夏",
                        "茉莉",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "桃野美桜",
                        "優宇(EVE)(2025.12.28引退予定)",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "結奈(REINA)",
                        "伊藤麻希\n小橋マリカ"
            ],
            [
                        2017,
                        "羽南",
                        "",
                        "",
                        "青野未来",
                        "トトロさつき(IR)\n星いぶき(IR)",
                        "",
                        "",
                        "デビーカイテル",
                        "",
                        "",
                        "愛海\n高瀬みゆき",
                        "",
                        "",
                        "NORI",
                        "",
                        "",
                        "沙恵",
                        "",
                        "ジュリア(WWE)",
                        "青木いつ希(SC)",
                        "関口翔"
            ],
            [
                        2018,
                        "吏南\n妃南\n鈴季すず\n水森由菜\n星来芽依\nジーナ",
                        "入江彩乃\n未依(休)",
                        "猫はるな(休)\n渡辺未詩\n原宿ぽむ\nらく\n愛野ユキ",
                        "林下詩美\n松井珠紗",
                        "",
                        "",
                        "駿河メイ",
                        "",
                        "谷もも",
                        "Maria\n川畑梨瑚",
                        "",
                        "狐伯",
                        "",
                        "",
                        "",
                        "",
                        "マリ卍",
                        "",
                        "白川未奈(AEW)",
                        "竹林早苗(BBJ)\n櫻井裕子(COLORS)\n網倉理奈(COLORS)\nKONOHA(銀河)(2026.5引退予定)\n花園桃花(アップタウン)\n杏ちゃむ(信州)",
                        ""
            ],
            [
                        2019,
                        "飯田沙耶\n上谷沙弥\n向後桃\n舞華(休)",
                        "",
                        "桐生真弥\n鈴芽",
                        "MIRAI",
                        "Yappy(IR)\nこゆき(HCC)",
                        "稲葉ともか\nrhythm",
                        "桐原季子\n小石川チエ\n沙也加",
                        "梅咲遥\n羽多乃ナナミ",
                        "AKARI\n久令愛",
                        "",
                        "岡優里佳",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "山中絵里奈(BBJ)",
                        "バニー及川\nマドレーヌ\nウナギ・サヤカ"
            ],
            [
                        2020,
                        "レディ・Ｃ\n壮麗亜美\n月山和香",
                        "",
                        "宮本もか",
                        "石川奈青\n桜井麻衣",
                        "",
                        "",
                        "",
                        "",
                        "大空ちえ",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "YuuRI",
                        "",
                        "",
                        "",
                        "鈴木ユラ(アルマリブレ)",
                        "真白優希\n柳川澄樺\n神姫楽ミサ"
            ],
            [
                        2021,
                        "虎龍清花",
                        "なる\n夏葵",
                        "遠藤有栖\n鳥喰かや\n荒井優希",
                        "CHIAKI",
                        "松下楓歩(IR)\nキク(HCC)",
                        "Aoi",
                        "",
                        "",
                        "",
                        "宝山愛",
                        "",
                        "咲蘭",
                        "花穂ノ利",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "鶴姫花（愛媛）\n緑野アミサ(アルマリブレ)\n豊田紗也夏(T-HEARTS)",
                        ""
            ],
            [
                        2022,
                        "天咲光由\nボジラ",
                        "荒幡寧々\n福永莉子\n水嶋さくら\nみあ朝子\n石川はるか\nKYANREN\n岩井杏加\n才原茉莉乃\n汐月なぎさ",
                        "HIMAWARI",
                        "ハミングバード\nメガトン\n後藤智香\n天麗皇希\n山田奈保(休)",
                        "海乃月雫(IR)\nしのせ愛梨紗(HCC・飛鳥兼任)",
                        "HisokA",
                        "四ツ葉ミヤ",
                        "Himiko\n美蘭",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "",
                        "フライング・ペンギン\nぽっぽちゃん",
                        "",
                        "",
                        "",
                        "",
                        "叶ミク(T-HEARTS)",
                        "七星"
            ],
            [
                        2023,
                        "さくらあや\nHANAKO\n玖麗さやか\n八神蘭奈",
                        "青葉ちい\n山下真菜\n研菜々美\n天翔ゆい",
                        "風城ハル\n芦田美歩\n大久保琉那(休)\n鈴木志乃\n凍雅\n上原わかな",
                        "ビクトリア弓月\n田中きずな\n勇気みなみ\n瀬戸レア",
                        "ゆづき(HCC)\nchou・chou(HCC)",
                        "稲葉あずさ",
                        "瀬戸ノノカ",
                        "香藤満月",
                        "",
                        "",
                        "YUNA",
                        "炎華\n郷田明日香(休)",
                        "",
                        "キャサリン.",
                        "noa",
                        "",
                        "",
                        "Chi Chi\nZONES",
                        "",
                        "志真うた(伊藤道場)",
                        "リアラ"
            ],
            [
                        2024,
                        "梨杏\n浜辺纏",
                        "アンリ\n永井絵梨沙\n千夜ヒナタ\n石塚美帆\n日菜といろ\n植原ゆきな",
                        "七瀬千花\nキラサマー\n高見汐珠",
                        "南小桃\n橘渚",
                        "若菜きらり(IR)\n緋彩ませ(HCC)",
                        "みず葉\nジャンボ井上\nビッグ春華",
                        "奏衣エリー\n谷綿ヒヨリ\n広海カホ",
                        "NENE",
                        "JENNE",
                        "彩芽蒼空\n暁千華",
                        "",
                        "",
                        "光芽ミリア",
                        "",
                        "レディくらら\nレディせりな",
                        "",
                        "クッキー",
                        "ソイ",
                        "",
                        "",
                        "咲村良子"
            ],
            [
                        2025,
                        "鉄アキラ\n姫ゆりあ\n金屋あんね\n儛島エマ\n古沢稀杏",
                        "梨央\n<弥福かな>\n<ゴんべ>",
                        "小夏れん",
                        "山岡聖怜\n心希\n山﨑裕花",
                        "りこ(IR)\n緋彩もえ(HCC)",
                        "ホルスタイン・エンジュ\nラブリカ・ヒナーノ\n枢夜 佐季",
                        "",
                        "<あんな>",
                        "",
                        "根本楓花（プロテスト合格）",
                        "",
                        "",
                        "風南ユキ\n望天セレネ\n<せいな>",
                        "わかな\n<彩夢>",
                        "",
                        "",
                        "星乃純奈",
                        "CHIKA",
                        "",
                        "苺畑ひより(666)\n横井真菜(REINA)",
                        ""
            ]
];

        debugLog(`データ読み込み完了: ${wrestlerData.length}行のデータ`);

        const promotionNames = ["Stardom", "AWG", "TJPW", "マリゴ", "IR/ホットシュシュ", "JTO", "チョコプロ", "Diana", "Pure-J", "マーベラス", "SENDAI", "Wave", "シード", "LLPW-X", "2.5", "ガンプロ", "柳ヶ瀬", "エボリューション", "海外", "その他", "フリー"];

        debugLog(`団体名定義完了: ${promotionNames.length}団体`);

        // 全ての関数を定義
        function calculateTotalWrestlers() {
            debugLog('選手数計算開始');
            let total = 0;
            try {
                wrestlerData.forEach((row) => {
                    for (let i = 1; i < row.length; i++) {
                        const wrestlers = row[i];
                        if (wrestlers && wrestlers.trim()) {
                            const wrestlerList = wrestlers.split('\n').filter(name => name.trim());
                            total += wrestlerList.length;
                        }
                    }
                });
                document.getElementById('totalWrestlers').textContent = total;
                debugLog(`総選手数: ${total}人`);
            } catch (error) {
                debugLog(`選手数計算エラー: ${error.message}`);
            }
        }

        function calculatePromotionWrestlerCounts() {
            debugLog('団体別選手数計算開始');
            const promotionCounts = new Array(promotionNames.length).fill(0);
            
            try {
                wrestlerData.forEach((row) => {
                    for (let i = 1; i < row.length && i <= promotionNames.length; i++) {
                        const wrestlers = row[i];
                        if (wrestlers && wrestlers.trim()) {
                            const wrestlerList = wrestlers.split('\n').filter(name => name.trim());
                            promotionCounts[i - 1] += wrestlerList.length;
                        }
                    }
                });
                
                debugLog(`団体別選手数計算完了: ${promotionCounts.join(', ')}`);
                return promotionCounts;
            } catch (error) {
                debugLog(`団体別選手数計算エラー: ${error.message}`);
                return promotionCounts;
            }
        }

        function updatePromotionHeaders() {
            debugLog('団体ヘッダー更新開始');
            try {
                const counts = calculatePromotionWrestlerCounts();
                const headers = document.querySelectorAll('.promotion-header');
                
                headers.forEach((header, index) => {
                    if (index < promotionNames.length && index < counts.length) {
                        const promotionName = promotionNames[index];
                        const count = counts[index];
                        header.textContent = `${promotionName}(${count})`;
                    }
                });
                
                debugLog('団体ヘッダー更新完了');
            } catch (error) {
                debugLog(`団体ヘッダー更新エラー: ${error.message}`);
            }
        }

        function renderTable(data) {
            debugLog('テーブル描画開始');
            try {
                const tableBody = document.getElementById('tableBody');
                if (!tableBody) {
                    debugLog('エラー: tableBodyが見つかりません');
                    return;
                }
                
                tableBody.innerHTML = '';
                debugLog('テーブルボディクリア完了');

                // ソート
                const sortedData = [...data].sort((a, b) => {
                    return sortOrder === 'desc' ? b[0] - a[0] : a[0] - b[0];
                });
                debugLog(`データソート完了: ${sortedData.length}行`);

                sortedData.forEach((row) => {
                    const tr = document.createElement('tr');
                    
                    // 年度セル
                    const yearTd = document.createElement('td');
                    yearTd.textContent = row[0];
                    yearTd.onclick = () => {
                        debugLog(`年度クリック: ${row[0]}`);
                        showYearDetail(row[0], row);
                    };
                    tr.appendChild(yearTd);

                    // 団体セル
                    for (let i = 1; i < row.length; i++) {
                        const td = document.createElement('td');
                        const wrestlers = row[i];
                        
                        if (wrestlers && wrestlers.trim()) {
                            td.innerHTML = wrestlers.trim().replace(/\n/g, '<br>');
                        } else {
                            td.className = 'empty-cell';
                        }
                        tr.appendChild(td);
                    }
                    
                    tableBody.appendChild(tr);
                });
                
                debugLog(`テーブル描画完了: ${sortedData.length}行追加`);
            } catch (error) {
                debugLog(`テーブル描画エラー: ${error.message}`);
                console.error(error);
            }
        }

        function toggleSort() {
            debugLog('ソート切り替え開始');
            try {
                sortOrder = sortOrder === 'desc' ? 'asc' : 'desc';
                const sortTh = document.querySelector('.sortable');
                if (sortTh) {
                    sortTh.className = 'sortable ' + sortOrder;
                }
                debugLog(`ソート順変更: ${sortOrder}`);
                
                renderTable(wrestlerData);
            } catch (error) {
                debugLog(`ソート切り替えエラー: ${error.message}`);
                console.error(error);
            }
        }

        function filterByPromotion(promotionName, promotionIndex) {
            debugLog(`団体フィルター開始: ${promotionName} (インデックス: ${promotionIndex})`);
            try {
                // 検索中の場合は検索結果から、そうでなければ全データからフィルター
                const sourceData = isSearching ? getCurrentFilteredData() : wrestlerData;
                
                const filteredResults = sourceData.filter(row => {
                    const wrestlers = row[promotionIndex];
                    return wrestlers && wrestlers.trim();
                });
                
                debugLog(`フィルター結果: ${filteredResults.length}行`);
                
                currentFilter = {
                    type: 'promotion',
                    value: promotionName,
                    data: filteredResults,
                    index: promotionIndex
                };
                isFiltered = true;
                
                showControls();
                showPromotionDetail(promotionName, filteredResults, promotionIndex);
            } catch (error) {
                debugLog(`団体フィルターエラー: ${error.message}`);
                console.error(error);
            }
        }

        // 現在の検索結果データを取得する関数
        function getCurrentFilteredData() {
            if (!isSearching) {
                return wrestlerData;
            }
            
            const searchInput = document.getElementById('wrestlerSearch');
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                return wrestlerData;
            }
            
            // 検索結果を再計算
            return wrestlerData.map(row => {
                const year = row[0];
                const newRow = [year];

                // 各団体のセルをチェック
                for (let i = 1; i < row.length; i++) {
                    const wrestlers = row[i];
                    if (wrestlers && wrestlers.trim()) {
                        // 選手名を分割して検索
                        const wrestlerList = wrestlers.split('\n')
                            .filter(name => name.trim())
                            .filter(name => name.toLowerCase().includes(searchTerm));

                        if (wrestlerList.length > 0) {
                            // マッチした選手名をハイライトなしで返す（団体フィルター用）
                            newRow.push(wrestlerList.join('\n'));
                        } else {
                            newRow.push('');
                        }
                    } else {
                        newRow.push('');
                    }
                }

                // 何らかの結果がある行のみ返す
                const hasResults = newRow.slice(1).some(cell => cell && cell.trim());
                return hasResults ? newRow : null;
            }).filter(row => row !== null);
        }

        function showYearDetail(year, yearRow) {
            debugLog(`年詳細表示開始: ${year}`);
            try {
                const promotions = [];
                
                for (let i = 1; i < yearRow.length && i - 1 < promotionNames.length; i++) {
                    const wrestlers = yearRow[i];
                    if (wrestlers && wrestlers.trim()) {
                        promotions.push({
                            name: promotionNames[i - 1],
                            wrestlers: wrestlers.split('\n').filter(name => name.trim())
                        });
                    }
                }
                
                debugLog(`年詳細: ${promotions.length}団体に選手在籍`);
                
                currentFilter = {type: 'year', value: year, data: promotions};
                isFiltered = true;
                
                showControls();
                showYearDetailView(year, promotions);
            } catch (error) {
                debugLog(`年詳細表示エラー: ${error.message}`);
                console.error(error);
            }
        }

        function showControls() {
            debugLog('コントロール表示');
            try {
                const controls = document.getElementById('controls');
                controls.style.display = 'flex';
                
                let html = '<button class="back-btn" onclick="resetFilter()">← 全体表示に戻る</button>';
                
                if (currentFilter) {
                    if (currentFilter.type === 'promotion') {
                        html += `<div class="filter-info">フィルター: ${currentFilter.value}</div>`;
                    } else if (currentFilter.type === 'year') {
                        html += `<div class="filter-info">フィルター: ${currentFilter.value}年</div>`;
                    }
                }
                
                controls.innerHTML = html;
                debugLog('コントロール表示完了');
            } catch (error) {
                debugLog(`コントロール表示エラー: ${error.message}`);
            }
        }

        function showPromotionDetail(promotionName, data, promotionIndex) {
            debugLog(`団体詳細表示: ${promotionName}`);
            try {
                document.getElementById('tableContainer').style.display = 'none';
                const yearDetailView = document.getElementById('yearDetailView');
                yearDetailView.style.display = 'block';
                
                let html = `
                    <div class="year-title">${promotionName} 所属選手一覧</div>
                    <div class="promotion-grid">
                `;
                
                data.forEach(row => {
                    const year = row[0];
                    const wrestlers = row[promotionIndex];
                    if (wrestlers && typeof wrestlers === 'string') {
                        const wrestlerList = wrestlers.split('\n')
                            .filter(name => name.trim())
                            .map(name => name.trim());
                        
                        html += `
                            <div class="promotion-card">
                                <div class="promotion-name-card">${year}年デビュー</div>
                                <div class="wrestler-names-card">${wrestlerList.join('<br>')}</div>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
                yearDetailView.innerHTML = html;
                debugLog('団体詳細表示完了');
            } catch (error) {
                debugLog(`団体詳細表示エラー: ${error.message}`);
            }
        }

        function showYearDetailView(year, promotions) {
            debugLog(`年別詳細表示: ${year}`);
            try {
                document.getElementById('tableContainer').style.display = 'none';
                const yearDetailView = document.getElementById('yearDetailView');
                yearDetailView.style.display = 'block';
                
                let html = `
                    <div class="year-title">${year}年デビュー選手一覧</div>
                    <div class="promotion-grid">
                `;
                
                promotions.forEach(promotion => {
                    html += `
                        <div class="promotion-card">
                            <div class="promotion-name-card">${promotion.name}</div>
                            <div class="wrestler-names-card">${promotion.wrestlers.join('<br>')}</div>
                        </div>
                    `;
                });
                
                html += '</div>';
                yearDetailView.innerHTML = html;
                debugLog('年別詳細表示完了');
            } catch (error) {
                debugLog(`年別詳細表示エラー: ${error.message}`);
            }
        }

        function resetFilter() {
            debugLog('フィルターリセット');
            try {
                currentFilter = null;
                isFiltered = false;
                
                document.getElementById('controls').style.display = 'none';
                document.getElementById('yearDetailView').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'block';
                
                // 検索中の場合は検索結果を再表示
                if (isSearching) {
                    searchWrestlers(); // 検索結果を再表示
                } else {
                    renderTable(wrestlerData);
                    updatePromotionHeaders();
                    calculateTotalWrestlers();
                    showAllColumns(); // 全ての列を表示
                    resetColumnWidths(); // 列幅をリセット
                }
                debugLog('フィルターリセット完了');
            } catch (error) {
                debugLog(`フィルターリセットエラー: ${error.message}`);
            }
        }

        // 選手名検索機能
        function searchWrestlers() {
            const searchInput = document.getElementById('wrestlerSearch');
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            debugLog(`選手検索開始: "${searchTerm}"`);
            
            if (searchTerm === '') {
                // 検索語が空の場合、全データを表示
                isSearching = false;
                originalData = null;
                resetFilter();
                renderTable(wrestlerData);
                updatePromotionHeaders();
                calculateTotalWrestlers();
                // ラベルを元に戻す
                document.getElementById('totalWrestlersLabel').textContent = '総現役選手数';
                // 全ての列を表示状態に戻す
                showAllColumns();
                // 列幅をリセット
                resetColumnWidths();
                debugLog('検索クリア: 全データ表示');
                return;
            }
            
            // 検索開始時にオリジナルデータを保存
            if (!isSearching) {
                originalData = [...wrestlerData];
                isSearching = true;
            }
            
            // 検索結果をフィルタリング
            const filteredData = wrestlerData.map(row => {
                const year = row[0];
                const newRow = [year];
                
                // 各団体のセルをチェック
                for (let i = 1; i < row.length; i++) {
                    const wrestlers = row[i];
                    if (wrestlers && wrestlers.trim()) {
                        // 選手名を分割して検索
                        const wrestlerList = wrestlers.split('\n')
                            .filter(name => name.trim())
                            .filter(name => name.toLowerCase().includes(searchTerm));
                        
                        if (wrestlerList.length > 0) {
                            // マッチした選手名をハイライト
                            const highlightedWrestlers = wrestlerList.map(name => 
                                name.replace(
                                    new RegExp(`(${searchTerm})`, 'gi'),
                                    '<span class="highlight">$1</span>'
                                )
                            );
                            newRow.push(highlightedWrestlers.join('\n'));
                        } else {
                            newRow.push('');
                        }
                    } else {
                        newRow.push('');
                    }
                }
                
                // 何らかの結果がある行のみ返す
                const hasResults = newRow.slice(1).some(cell => cell && cell.trim());
                return hasResults ? newRow : null;
            }).filter(row => row !== null);
            
            debugLog(`検索結果: ${filteredData.length}行がマッチ`);
            
            // 検索結果を表示
            renderTable(filteredData);
            updateSearchResultHeaders(filteredData);
            calculateSearchResultWrestlers(filteredData);
            
            // フィルターやその他の表示をリセット
            if (isFiltered) {
                currentFilter = null;
                isFiltered = false;
                document.getElementById('controls').style.display = 'none';
                document.getElementById('yearDetailView').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'block';
            }
        }

        // 検索結果用のヘッダー更新
        function updateSearchResultHeaders(filteredData) {
            debugLog('検索結果ヘッダー更新開始');
            try {
                const counts = new Array(promotionNames.length).fill(0);
                
                filteredData.forEach((row) => {
                    for (let i = 1; i < row.length && i <= promotionNames.length; i++) {
                        const wrestlers = row[i];
                        if (wrestlers && wrestlers.trim()) {
                            // HTMLタグを除去してカウント
                            const cleanWrestlers = wrestlers.replace(/<[^>]*>/g, '');
                            const wrestlerList = cleanWrestlers.split('\n').filter(name => name.trim());
                            counts[i - 1] += wrestlerList.length;
                        }
                    }
                });
                
                const headers = document.querySelectorAll('.promotion-header');
                headers.forEach((header, index) => {
                    if (index < promotionNames.length && index < counts.length) {
                        const promotionName = promotionNames[index];
                        const count = counts[index];
                        header.textContent = `${promotionName}(${count})`;
                        
                        // 選手数が0の場合は列を非表示にする
                        if (count === 0) {
                            header.classList.add('hidden-column');
                        } else {
                            header.classList.remove('hidden-column');
                        }
                    }
                });
                
                // テーブルボディの対応する列も非表示にする
                hideEmptyColumnsInTable(counts);
                
                // 列幅を調整する（少し遅延させて確実に適用）
                setTimeout(() => adjustColumnWidths(counts), 50);
                
                debugLog('検索結果ヘッダー更新完了');
            } catch (error) {
                debugLog(`検索結果ヘッダー更新エラー: ${error.message}`);
            }
        }

        // テーブルボディの空の列を非表示にする関数
        function hideEmptyColumnsInTable(counts) {
            debugLog('空の列非表示処理開始');
            try {
                const tableRows = document.querySelectorAll('#tableBody tr');
                
                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    // 最初のセル（年度）は除外して、団体セルのみ処理
                    for (let i = 1; i < cells.length && i - 1 < counts.length; i++) {
                        const count = counts[i - 1];
                        if (count === 0) {
                            cells[i].classList.add('hidden-column');
                        } else {
                            cells[i].classList.remove('hidden-column');
                        }
                    }
                });
                
                debugLog('空の列非表示処理完了');
            } catch (error) {
                debugLog(`空の列非表示処理エラー: ${error.message}`);
            }
        }

        // 全ての列を表示状態に戻す関数
        function showAllColumns() {
            debugLog('全列表示処理開始');
            try {
                // ヘッダーの表示を戻す
                const headers = document.querySelectorAll('.promotion-header');
                headers.forEach(header => {
                    header.classList.remove('hidden-column');
                });
                
                // テーブルボディの表示を戻す
                const tableRows = document.querySelectorAll('#tableBody tr');
                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    cells.forEach(cell => {
                        cell.classList.remove('hidden-column');
                    });
                });
                
                debugLog('全列表示処理完了');
            } catch (error) {
                debugLog(`全列表示処理エラー: ${error.message}`);
            }
        }

        // 動的列幅計算と適用関数
        function adjustColumnWidths(counts) {
            debugLog('列幅調整処理開始');
            try {
                const tableContainer = document.getElementById('tableContainer');
                const visibleColumns = counts.filter(count => count > 0).length;
                
                if (visibleColumns < promotionNames.length && visibleColumns > 0) {
                    // 絞り込みが発生している場合
                    tableContainer.classList.add('filtered');
                    
                    // 利用可能な幅を計算（年度列を除く）
                    const containerWidth = tableContainer.offsetWidth || 1600; // デフォルト値を設定
                    const yearColumnWidth = 60; // 絞り込み時の年度列の幅
                    const availableWidth = containerWidth - yearColumnWidth - 80; // マージン考慮
                    
                    // 表示されている列数で均等分割（最小120px、最大250px）
                    const rawColumnWidth = Math.floor(availableWidth / visibleColumns);
                    const columnWidth = Math.max(120, Math.min(250, rawColumnWidth));
                    
                    debugLog(`コンテナ幅: ${containerWidth}px, 利用可能幅: ${availableWidth}px, 表示列数: ${visibleColumns}, 列幅: ${columnWidth}px`);
                    
                    // 表示されている列に動的幅を適用
                    const headers = document.querySelectorAll('.promotion-header');
                    headers.forEach((header, index) => {
                        if (index < counts.length) {
                            if (counts[index] > 0) {
                                header.style.width = `${columnWidth}px`;
                                header.style.minWidth = `${columnWidth}px`;
                                header.style.maxWidth = `${columnWidth}px`;
                            }
                        }
                    });
                    
                    // テーブルボディの対応するセルにも適用（少し遅延して適用）
                    setTimeout(() => {
                        const tableRows = document.querySelectorAll('#tableBody tr');
                        tableRows.forEach(row => {
                            const cells = row.querySelectorAll('td');
                            for (let i = 1; i < cells.length && i - 1 < counts.length; i++) {
                                if (counts[i - 1] > 0) {
                                    cells[i].style.width = `${columnWidth}px`;
                                    cells[i].style.minWidth = `${columnWidth}px`;
                                    cells[i].style.maxWidth = `${columnWidth}px`;
                                }
                            }
                        });
                    }, 100);
                    
                    debugLog(`列幅調整完了: ${visibleColumns}列、各列幅${columnWidth}px`);
                } else {
                    // 絞り込みがない場合は元の幅に戻す
                    resetColumnWidths();
                }
            } catch (error) {
                debugLog(`列幅調整エラー: ${error.message}`);
                console.error(error);
            }
        }

        // 列幅をリセットする関数
        function resetColumnWidths() {
            debugLog('列幅リセット処理開始');
            try {
                const tableContainer = document.getElementById('tableContainer');
                tableContainer.classList.remove('filtered');
                
                // CSSカスタムプロパティをリセット
                document.documentElement.style.removeProperty('--dynamic-column-width');
                
                // ヘッダーのスタイルをリセット
                const headers = document.querySelectorAll('.promotion-header');
                headers.forEach(header => {
                    header.style.width = '';
                    header.style.minWidth = '';
                    header.style.maxWidth = '';
                });
                
                // テーブルボディのスタイルをリセット
                const tableRows = document.querySelectorAll('#tableBody tr');
                tableRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    cells.forEach(cell => {
                        if (!cell.classList.contains('year-cell')) {
                            cell.style.width = '';
                            cell.style.minWidth = '';
                            cell.style.maxWidth = '';
                        }
                    });
                });
                
                debugLog('列幅リセット完了');
            } catch (error) {
                debugLog(`列幅リセットエラー: ${error.message}`);
            }
        }

        // 検索結果の選手数計算
        function calculateSearchResultWrestlers(filteredData) {
            debugLog('検索結果選手数計算開始');
            let total = 0;
            try {
                filteredData.forEach((row) => {
                    for (let i = 1; i < row.length; i++) {
                        const wrestlers = row[i];
                        if (wrestlers && wrestlers.trim()) {
                            // HTMLタグを除去してカウント
                            const cleanWrestlers = wrestlers.replace(/<[^>]*>/g, '');
                            const wrestlerList = cleanWrestlers.split('\n').filter(name => name.trim());
                            total += wrestlerList.length;
                        }
                    }
                });
                document.getElementById('totalWrestlers').textContent = total;
                document.getElementById('totalWrestlersLabel').textContent = '絞り込み後選手数';
                debugLog(`検索結果選手数: ${total}人`);
            } catch (error) {
                debugLog(`検索結果選手数計算エラー: ${error.message}`);
            }
        }

        // 検索クリア機能
        function clearSearch() {
            debugLog('検索クリア開始');
            try {
                const searchInput = document.getElementById('wrestlerSearch');
                searchInput.value = '';
                
                isSearching = false;
                originalData = null;
                
                resetFilter();
                renderTable(wrestlerData);
                updatePromotionHeaders();
                calculateTotalWrestlers();
                
                // ラベルを元に戻す
                document.getElementById('totalWrestlersLabel').textContent = '総現役選手数';
                
                // 全ての列を表示状態に戻す
                showAllColumns();
                
                // 列幅をリセット
                resetColumnWidths();
                
                debugLog('検索クリア完了');
            } catch (error) {
                debugLog(`検索クリアエラー: ${error.message}`);
            }
        }

        // 初期表示
        window.onload = function() {
            debugLog('window.onload開始');
            try {
                renderTable(wrestlerData);
                debugLog('テーブル描画完了');
                calculateTotalWrestlers();
                debugLog('選手数計算完了');
                updatePromotionHeaders();
                debugLog('団体ヘッダー更新完了');
                debugLog('初期化完了 - 全ての機能が利用可能です');
            } catch (error) {
                debugLog(`初期化エラー: ${error.message}`);
                console.error(error);
            }
        };

        debugLog('全ての関数定義完了');
    </script>
</body>
</html>